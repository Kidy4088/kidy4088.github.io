(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{609:function(s,e,a){"use strict";a.r(e);var n=a(2),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1-springmvc自动配置概览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-springmvc自动配置概览"}},[s._v("#")]),s._v(" 1. SpringMVC自动配置概览")]),s._v(" "),a("p",[s._v("Spring Boot provides auto-configuration for Spring MVC that "),a("strong",[s._v("works well with most applications.(大多场景我们都无需自定义配置)")])]),s._v(" "),a("p",[s._v("The auto-configuration adds the following features on top of Spring’s defaults:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Inclusion of "),a("code",[s._v("ContentNegotiatingViewResolver")]),s._v(" and "),a("code",[s._v("BeanNameViewResolver")]),s._v(" beans.")]),s._v(" "),a("ul",[a("li",[s._v("内容协商视图解析器和 BeanName 视图解析器")])])]),s._v(" "),a("li",[a("p",[s._v("Support for serving static resources, including support for WebJars (covered "),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content",target:"_blank",rel:"noopener noreferrer"}},[s._v("later in this document"),a("OutboundLink")],1),s._v(")).")]),s._v(" "),a("ul",[a("li",[s._v("静态资源（包括 webjars）")])])]),s._v(" "),a("li",[a("p",[s._v("Automatic registration of "),a("code",[s._v("Converter")]),s._v(", "),a("code",[s._v("GenericConverter")]),s._v(", and "),a("code",[s._v("Formatter")]),s._v(" beans.")]),s._v(" "),a("ul",[a("li",[s._v("自动注册 "),a("code",[s._v("Converter，GenericConverter，Formatter")])])])]),s._v(" "),a("li",[a("p",[s._v("Support for "),a("code",[s._v("HttpMessageConverters")]),s._v(" (covered "),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-message-converters",target:"_blank",rel:"noopener noreferrer"}},[s._v("later in this document"),a("OutboundLink")],1),s._v(").")]),s._v(" "),a("ul",[a("li",[s._v("支持 "),a("code",[s._v("HttpMessageConverters")]),s._v("（后来我们配合内容协商理解原理）")])])]),s._v(" "),a("li",[a("p",[s._v("Automatic registration of "),a("code",[s._v("MessageCodesResolver")]),s._v(" (covered "),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-message-codes",target:"_blank",rel:"noopener noreferrer"}},[s._v("later in this document"),a("OutboundLink")],1),s._v(").")]),s._v(" "),a("ul",[a("li",[s._v("自动注册 "),a("code",[s._v("MessageCodesResolver")]),s._v("（国际化用）")])])]),s._v(" "),a("li",[a("p",[s._v("Static "),a("code",[s._v("index.html")]),s._v(" support.")]),s._v(" "),a("ul",[a("li",[s._v("静态 index.html 页支持")])])]),s._v(" "),a("li",[a("p",[s._v("Custom "),a("code",[s._v("Favicon")]),s._v(" support (covered "),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-favicon",target:"_blank",rel:"noopener noreferrer"}},[s._v("later in this document"),a("OutboundLink")],1),s._v(").")]),s._v(" "),a("ul",[a("li",[s._v("自定义 "),a("code",[s._v("Favicon")])])])]),s._v(" "),a("li",[a("p",[s._v("Automatic use of a "),a("code",[s._v("ConfigurableWebBindingInitializer")]),s._v(" bean (covered "),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-web-binding-initializer",target:"_blank",rel:"noopener noreferrer"}},[s._v("later in this document"),a("OutboundLink")],1),s._v(").")]),s._v(" "),a("ul",[a("li",[s._v("自动使用 "),a("code",[s._v("ConfigurableWebBindingInitializer")]),s._v(" ，（DataBinder 负责将请求数据绑定到JavaBean上）")])])])]),s._v(" "),a("blockquote",[a("p",[s._v("If you want to keep those Spring Boot MVC customizations and make more "),a("a",{attrs:{href:"https://docs.spring.io/spring/docs/5.2.9.RELEASE/spring-framework-reference/web.html#mvc",target:"_blank",rel:"noopener noreferrer"}},[s._v("MVC customizations"),a("OutboundLink")],1),s._v(" (interceptors, formatters, view controllers, and other features), you can add your own "),a("code",[s._v("@Configuration")]),s._v(" class of type "),a("code",[s._v("WebMvcConfigurer")]),s._v(" but "),a("strong",[s._v("without")]),s._v(" "),a("code",[s._v("@EnableWebMvc")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("不用@EnableWebMvc注解。使用")]),s._v(" "),a("strong",[a("code",[s._v("@Configuration")])]),s._v(" "),a("strong",[s._v("+")]),s._v(" "),a("strong",[a("code",[s._v("WebMvcConfigurer")])]),s._v(" "),a("strong",[s._v("自定义规则")])])]),s._v(" "),a("blockquote",[a("p",[s._v("If you want to provide custom instances of "),a("code",[s._v("RequestMappingHandlerMapping")]),s._v(", "),a("code",[s._v("RequestMappingHandlerAdapter")]),s._v(", or "),a("code",[s._v("ExceptionHandlerExceptionResolver")]),s._v(", and still keep the Spring Boot MVC customizations, you can declare a bean of type "),a("code",[s._v("WebMvcRegistrations")]),s._v(" and use it to provide custom instances of those components.")]),s._v(" "),a("p",[a("strong",[s._v("声明")]),s._v(" "),a("strong",[a("code",[s._v("WebMvcRegistrations")])]),s._v(" "),a("strong",[s._v("改变默认底层组件")])])]),s._v(" "),a("blockquote",[a("p",[s._v("If you want to take complete control of Spring MVC, you can add your own "),a("code",[s._v("@Configuration")]),s._v(" annotated with "),a("code",[s._v("@EnableWebMvc")]),s._v(", or alternatively add your own "),a("code",[s._v("@Configuration")]),s._v("-annotated "),a("code",[s._v("DelegatingWebMvcConfiguration")]),s._v(" as described in the Javadoc of "),a("code",[s._v("@EnableWebMvc")]),s._v(".")]),s._v(" "),a("p",[a("strong",[s._v("使用")]),s._v(" "),a("strong",[a("code",[s._v("@EnableWebMvc+@Configuration+DelegatingWebMvcConfiguration 全面接管 SpringMVC")])])])]),s._v(" "),a("h2",{attrs:{id:"_2-简单功能分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-简单功能分析"}},[s._v("#")]),s._v(" 2. 简单功能分析")]),s._v(" "),a("h3",{attrs:{id:"_2-1-静态资源访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-静态资源访问"}},[s._v("#")]),s._v(" 2.1 静态资源访问")]),s._v(" "),a("h4",{attrs:{id:"_2-1-1-静态资源目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-静态资源目录"}},[s._v("#")]),s._v(" 2.1.1 静态资源目录")]),s._v(" "),a("p",[s._v("只要静态资源放在类路径下： called "),a("code",[s._v("/static")]),s._v(" (or "),a("code",[s._v("/public")]),s._v(" or "),a("code",[s._v("/resources")]),s._v(" or "),a("code",[s._v("/META-INF/resources")])]),s._v(" "),a("p",[s._v("访问 ： 当前项目根路径/ + 静态资源名")]),s._v(" "),a("p",[s._v("原理： 静态映射/**。")]),s._v(" "),a("p",[s._v("请求进来，先去找 Controller 看能不能处理。不能处理的所有请求又都交给静态资源处理器。静态资源也找不到则响应 404 页面")]),s._v(" "),a("p",[s._v("改变默认的静态资源路径")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mvc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static-path-pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /res/"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static-locations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("classpath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/haha/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_2-1-2-静态资源访问前缀"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-静态资源访问前缀"}},[s._v("#")]),s._v(" 2.1.2 静态资源访问前缀")]),s._v(" "),a("p",[s._v("默认无前缀")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mvc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static-path-pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /res/"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("当前项目 + static-path-pattern + 静态资源名 = 静态资源文件夹下找")]),s._v(" "),a("h4",{attrs:{id:"_2-1-3-webjar"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-webjar"}},[s._v("#")]),s._v(" 2.1.3 webjar")]),s._v(" "),a("p",[s._v("自动映射 /"),a("a",{attrs:{href:"http://localhost:8080/webjars/jquery/3.5.1/jquery.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("webjars"),a("OutboundLink")],1),s._v("/**")]),s._v(" "),a("p",[s._v("https://www.webjars.org/")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.webjars"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jquery"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("3.5.1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("访问地址："),a("a",{attrs:{href:"http://localhost:8080/webjars/jquery/3.5.1/jquery.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:8080/webjars/"),a("strong",[s._v("jquery/3.5.1/jquery.js")]),a("OutboundLink")],1),s._v("  后面地址要按照依赖里面的包路径")]),s._v(" "),a("h3",{attrs:{id:"_2-2-欢迎页支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-欢迎页支持"}},[s._v("#")]),s._v(" 2.2 欢迎页支持")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("静态资源路径下  index.html")])]),s._v(" "),a("li",[a("p",[s._v("可以配置静态资源路径")])]),s._v(" "),a("li",[a("p",[s._v("但是不可以配置静态资源的访问前缀。否则导致 index.html 不能被默认访问")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("spring:\n#  mvc:\n#    static-path-pattern: /res/**   这个会导致welcome page功能失效\n\n  resources:\n    static-locations: [classpath:/haha/]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("controller能处理 /index")])]),s._v(" "),a("h3",{attrs:{id:"_2-3-自定义-favicon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-自定义-favicon"}},[s._v("#")]),s._v(" 2.3 自定义  Favicon")]),s._v(" "),a("p",[s._v("favicon.ico 放在静态资源目录下即可。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("spring:\n#  mvc:\n#    static-path-pattern: /res/**   这个会导致 Favicon 功能失效\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_2-4-静态资源配置原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-静态资源配置原理"}},[s._v("#")]),s._v(" 2.4 静态资源配置原理")]),s._v(" "),a("ul",[a("li",[s._v("SpringBoot 启动默认加载  xxxAutoConfiguration 类（自动配置类）")]),s._v(" "),a("li",[s._v("SpringMVC 功能的自动配置类 WebMvcAutoConfiguration，生效")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("proxyBeanMethods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ConditionalOnWebApplication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SERVLET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ConditionalOnClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Servlet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DispatcherServlet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcConfigurer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ConditionalOnMissingBean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcConfigurationSupport")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@AutoConfigureOrder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ordered")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HIGHEST_PRECEDENCE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@AutoConfigureAfter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DispatcherServletAutoConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskExecutionAutoConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ValidationAutoConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcAutoConfiguration")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ul",[a("li",[s._v("给容器中配了什么。")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("proxyBeanMethods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EnableWebMvcConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@EnableConfigurationProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResourceProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Order")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcAutoConfigurationAdapter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcConfigurer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("配置文件的相关属性和xxx进行了绑定。WebMvcProperties=="),a("strong",[s._v("spring.mvc")]),s._v("、ResourceProperties=="),a("strong",[s._v("spring.resources")])])]),s._v(" "),a("h4",{attrs:{id:"_2-4-1-配置类只有一个有参构造器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-配置类只有一个有参构造器"}},[s._v("#")]),s._v(" 2.4.1 配置类只有一个有参构造器")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//有参构造器所有参数的值都会从容器中确定")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ResourceProperties resourceProperties；获取和spring.resources绑定的所有的值的对象")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//WebMvcProperties mvcProperties 获取和spring.mvc绑定的所有的值的对象")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ListableBeanFactory beanFactory Spring的beanFactory")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//HttpMessageConverters 找到所有的HttpMessageConverters")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ResourceHandlerRegistrationCustomizer 找到 资源处理器的自定义器。=========")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//DispatcherServletPath  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ServletRegistrationBean   给应用注册Servlet、Filter....")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcAutoConfigurationAdapter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResourceProperties")]),s._v(" resourceProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcProperties")]),s._v(" mvcProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ListableBeanFactory")]),s._v(" beanFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectProvider")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpMessageConverters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" messageConvertersProvider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectProvider")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResourceHandlerRegistrationCustomizer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" resourceHandlerRegistrationCustomizerProvider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectProvider")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DispatcherServletPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" dispatcherServletPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectProvider")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletRegistrationBean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" servletRegistrations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("resourceProperties "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" resourceProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mvcProperties "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mvcProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("beanFactory "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" beanFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("messageConvertersProvider "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" messageConvertersProvider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("resourceHandlerRegistrationCustomizer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" resourceHandlerRegistrationCustomizerProvider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getIfAvailable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dispatcherServletPath "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dispatcherServletPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servletRegistrations "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" servletRegistrations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h4",{attrs:{id:"_2-4-2-资源处理的默认规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2-资源处理的默认规则"}},[s._v("#")]),s._v(" 2.4.2 资源处理的默认规则")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@Override\npublic void addResourceHandlers(ResourceHandlerRegistry registry) {\n    if (!this.resourceProperties.isAddMappings()) {\n        logger.debug("Default resource handling disabled");\n        return;\n    }\n    Duration cachePeriod = this.resourceProperties.getCache().getPeriod();\n    CacheControl cacheControl = this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();\n    //webjars的规则\n    if (!registry.hasMappingForPattern("/webjars/**")) {\n        customizeResourceHandlerRegistration(registry.addResourceHandler("/webjars/**")\n                .addResourceLocations("classpath:/META-INF/resources/webjars/")\n                .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));\n    }\n    \n    //\n    String staticPathPattern = this.mvcProperties.getStaticPathPattern();\n    if (!registry.hasMappingForPattern(staticPathPattern)) {\n        customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)\n                .addResourceLocations(getResourceLocations(this.resourceProperties.getStaticLocations()))\n                .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));\n    }\n}\nspring:\n#  mvc:\n#    static-path-pattern: /res/**\n\n  resources:\n    add-mappings: false   禁用所有静态资源规则\n    \n@ConfigurationProperties(prefix = "spring.resources", ignoreUnknownFields = false)\npublic class ResourceProperties {\n\n    private static final String[] CLASSPATH_RESOURCE_LOCATIONS = { "classpath:/META-INF/resources/",\n            "classpath:/resources/", "classpath:/static/", "classpath:/public/" };\n\n    /**\n     * Locations of static resources. Defaults to classpath:[/META-INF/resources/,\n     * /resources/, /static/, /public/].\n     */\n    private String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("h4",{attrs:{id:"_2-4-3-欢迎页的处理规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-3-欢迎页的处理规则"}},[s._v("#")]),s._v(" 2.4.3 欢迎页的处理规则")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('HandlerMapping：处理器映射。保存了每一个Handler能处理哪些请求。  \n\n@Bean\npublic WelcomePageHandlerMapping welcomePageHandlerMapping(ApplicationContext applicationContext,\n        FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider) {\n    WelcomePageHandlerMapping welcomePageHandlerMapping = new WelcomePageHandlerMapping(\n            new TemplateAvailabilityProviders(applicationContext), applicationContext, getWelcomePage(),\n            this.mvcProperties.getStaticPathPattern());\n    welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));\n    welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());\n    return welcomePageHandlerMapping;\n}\n\nWelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,\n        ApplicationContext applicationContext, Optional<Resource> welcomePage, String staticPathPattern) {\n    if (welcomePage.isPresent() && "/**".equals(staticPathPattern)) {\n        //要用欢迎页功能，必须是/**\n        logger.info("Adding welcome page: " + welcomePage.get());\n        setRootViewName("forward:index.html");\n    }\n    else if (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) {\n        // 调用Controller  /index\n        logger.info("Adding welcome page template: index");\n        setRootViewName("index");\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h2",{attrs:{id:"_3-请求参数处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-请求参数处理"}},[s._v("#")]),s._v(" 3. 请求参数处理")]),s._v(" "),a("h3",{attrs:{id:"_3-1-请求映射"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-请求映射"}},[s._v("#")]),s._v(" 3.1 请求映射")]),s._v(" "),a("h4",{attrs:{id:"_3-1-1-rest使用与原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-rest使用与原理"}},[s._v("#")]),s._v(" 3.1.1 rest使用与原理")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("@xxxMapping；")])]),s._v(" "),a("li",[a("p",[s._v("Rest 风格支持（"),a("em",[s._v("使用 "),a("strong",[s._v("HTTP")]),s._v(" 请求方式动词来表示对资源的操作")]),s._v("）")])]),s._v(" "),a("li",[a("p",[a("em",[s._v("以前：**/getUser")]),s._v(" "),a("em",[s._v("获取用户")]),s._v(" "),a("em",[s._v("/deleteUser")]),s._v(" "),a("em",[s._v("删除用户")]),s._v(" "),a("em",[s._v("/editUser")]),s._v(" "),a("em",[s._v("修改用户")]),s._v(" "),a("em",[s._v("/saveUser")]),s._v(" "),a("em",[s._v("保存用户")])])]),s._v(" "),a("li",[a("p",[a("em",[s._v("现在： /user")]),s._v("   *GET-*"),a("em",[s._v("获取用户")]),s._v("   *DELETE-*"),a("em",[s._v("删除用户")]),s._v("   *PUT-*"),a("em",[s._v("修改用户")]),s._v("    *POST-*"),a("em",[s._v("保存用户")])])]),s._v(" "),a("li",[a("p",[s._v("核心 Filter：HiddenHttpMethodFilter")])]),s._v(" "),a("li",[a("p",[s._v("用法： 表单 method=post，隐藏域  _method=put")])]),s._v(" "),a("li",[a("p",[s._v("SpringBoot 中手动开启")])]),s._v(" "),a("li",[a("p",[s._v("扩展：如何把 _method 这个名字换成我们自己喜欢的。")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@RequestMapping(value = "/user",method = RequestMethod.GET)\npublic String getUser(){\n    return "GET-张三";\n}\n\n@RequestMapping(value = "/user",method = RequestMethod.POST)\npublic String saveUser(){\n    return "POST-张三";\n}\n\n\n@RequestMapping(value = "/user",method = RequestMethod.PUT)\npublic String putUser(){\n    return "PUT-张三";\n}\n\n@RequestMapping(value = "/user",method = RequestMethod.DELETE)\npublic String deleteUser(){\n    return "DELETE-张三";\n}\n\n\n@Bean\n@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)\n@ConditionalOnProperty(prefix = "spring.mvc.hiddenmethod.filter", name = "enabled", matchIfMissing = false)\npublic OrderedHiddenHttpMethodFilter hiddenHttpMethodFilter() {\n    return new OrderedHiddenHttpMethodFilter();\n}\n\n\n//自定义filter\n@Bean\npublic HiddenHttpMethodFilter hiddenHttpMethodFilter(){\n    HiddenHttpMethodFilter methodFilter = new HiddenHttpMethodFilter();\n    methodFilter.setMethodParam("_m");\n    return methodFilter;\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[s._v("Rest原理（表单提交要使用REST的时候）")]),s._v(" "),a("ul",[a("li",[s._v("表单提交会带上 "),a("strong",[s._v("_method=PUT")])]),s._v(" "),a("li",[s._v("请求过来被 HiddenHttpMethodFilter 拦截")]),s._v(" "),a("li",[s._v("请求是否正常，并且是 POST")]),s._v(" "),a("li",[s._v("获取到 "),a("strong",[s._v("_method")]),s._v(" 的值。")]),s._v(" "),a("li",[s._v("兼容以下请求；"),a("strong",[s._v("PUT")]),s._v(","),a("strong",[s._v("DELETE")]),s._v(","),a("strong",[s._v("PATCH")])]),s._v(" "),a("li",[a("strong",[s._v("原生 request(post)，包装模式 requesWrapper 重写了 getMethod 方法，返回的是传入的值。")])]),s._v(" "),a("li",[a("strong",[s._v("过滤器链放行的时候用 wrapper。以后的方法调用 getMethod 是调用requesWrapper 的。")])])]),s._v(" "),a("p",[a("strong",[s._v("Rest使用客户端工具，")])]),s._v(" "),a("ul",[a("li",[s._v("如PostMan直接发送Put、delete等方式请求，无需Filter。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("spring:\n  mvc:\n    hiddenmethod:\n      filter:\n        enabled: true   #开启页面表单的Rest功能\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_3-1-2-请求映射原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-请求映射原理"}},[s._v("#")]),s._v(" 3.1.2 请求映射原理")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182523.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("SpringMVC 功能分析都从 org.springframework.web.servlet.DispatcherServlet->doDispatch（）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {\n\tHttpServletRequest processedRequest = request;\n\tHandlerExecutionChain mappedHandler = null;\n\tboolean multipartRequestParsed = false;\n\n\tWebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);\n\n\ttry {\n\t    ModelAndView mv = null;\n\t    Exception dispatchException = null;\n\n\t    try {\n\t        processedRequest = checkMultipart(request);\n\t        multipartRequestParsed = (processedRequest != request);\n\n\t        // 找到当前请求使用哪个Handler（Controller的方法）处理\n\t        mappedHandler = getHandler(processedRequest);\n\t        \n\t        //HandlerMapping：处理器映射。/xxx->>xxxx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182541.png",alt:"image.png"}})]),s._v(" "),a("p",[a("strong",[s._v("RequestMappingHandlerMapping")]),s._v("：保存了所有@RequestMapping 和handler的映射规则。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182548.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("所有的请求映射都在 HandlerMapping 中。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("SpringBoot 自动配置欢迎页的 WelcomePageHandlerMapping 。访问 / 能访问到")]),s._v(" "),a("p",[s._v("index.html")])]),s._v(" "),a("li",[a("p",[s._v("SpringBoot 自动配置了默认 的 RequestMappingHandlerMapping")])]),s._v(" "),a("li",[a("p",[s._v("请求进来，挨个尝试所有的 HandlerMapping 看是否有请求信息。")])]),s._v(" "),a("li",[a("p",[s._v("如果有就找到这个请求对应的handler")])]),s._v(" "),a("li",[a("p",[s._v("如果没有就是下一个 HandlerMapping")])]),s._v(" "),a("li",[a("p",[s._v("我们需要一些自定义的映射处理，我们也可以自己给容器中放 "),a("strong",[s._v("HandlerMapping")]),s._v("。自定义 "),a("strong",[s._v("HandlerMapping")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {\n    if (this.handlerMappings != null) {\n        for (HandlerMapping mapping : this.handlerMappings) {\n            HandlerExecutionChain handler = mapping.getHandler(request);\n            if (handler != null) {\n                return handler;\n            }\n        }\n    }\n    return null;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"_3-2-普通参数与基本注解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-普通参数与基本注解"}},[s._v("#")]),s._v(" 3.2 普通参数与基本注解")]),s._v(" "),a("h4",{attrs:{id:"_3-2-1-注解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-注解"}},[s._v("#")]),s._v(" 3.2.1 注解")]),s._v(" "),a("p",[s._v("@PathVariable、@RequestHeader、@ModelAttribute、@RequestParam、@MatrixVariable、@CookieValue、@RequestBody")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@RestController\npublic class ParameterTestController {\n\n\n    //  car/2/owner/zhangsan\n    @GetMapping("/car/{id}/owner/{username}")\n    public Map<String,Object> getCar(@PathVariable("id") Integer id,\n                                     @PathVariable("username") String name,\n                                     @PathVariable Map<String,String> pv,\n                                     @RequestHeader("User-Agent") String userAgent,\n                                     @RequestHeader Map<String,String> header,\n                                     @RequestParam("age") Integer age,\n                                     @RequestParam("inters") List<String> inters,\n                                     @RequestParam Map<String,String> params,\n                                     @CookieValue("_ga") String _ga,\n                                     @CookieValue("_ga") Cookie cookie){\n\n\n        Map<String,Object> map = new HashMap<>();\n\n//        map.put("id",id);\n//        map.put("name",name);\n//        map.put("pv",pv);\n//        map.put("userAgent",userAgent);\n//        map.put("headers",header);\n        map.put("age",age);\n        map.put("inters",inters);\n        map.put("params",params);\n        map.put("_ga",_ga);\n        System.out.println(cookie.getName()+"===>"+cookie.getValue());\n        return map;\n    }\n\n\n    @PostMapping("/save")\n    public Map postMethod(@RequestBody String content){\n        Map<String,Object> map = new HashMap<>();\n        map.put("content",content);\n        return map;\n    }\n\n\n    //1、语法： 请求路径：/cars/sell;low=34;brand=byd,audi,yd\n    //2、SpringBoot默认是禁用了矩阵变量的功能\n    //      手动开启：原理。对于路径的处理。UrlPathHelper进行解析。\n    //              removeSemicolonContent（移除分号内容）支持矩阵变量的\n    //3、矩阵变量必须有url路径变量才能被解析\n    @GetMapping("/cars/{path}")\n    public Map carsSell(@MatrixVariable("low") Integer low,\n                        @MatrixVariable("brand") List<String> brand,\n                        @PathVariable("path") String path){\n        Map<String,Object> map = new HashMap<>();\n\n        map.put("low",low);\n        map.put("brand",brand);\n        map.put("path",path);\n        return map;\n    }\n\n    // /boss/1;age=20/2;age=10\n\n    @GetMapping("/boss/{bossId}/{empId}")\n    public Map boss(@MatrixVariable(value = "age",pathVar = "bossId") Integer bossAge,\n                    @MatrixVariable(value = "age",pathVar = "empId") Integer empAge){\n        Map<String,Object> map = new HashMap<>();\n\n        map.put("bossAge",bossAge);\n        map.put("empAge",empAge);\n        return map;\n\n    }\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br")])]),a("h4",{attrs:{id:"_3-2-2-servlet-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-servlet-api"}},[s._v("#")]),s._v(" 3.2.2  Servlet API")]),s._v(" "),a("p",[s._v("WebRequest、ServletRequest、MultipartRequest、 HttpSession、javax.servlet.http.PushBuilder、Principal、InputStream、Reader、HttpMethod、Locale、TimeZone、ZoneId")]),s._v(" "),a("p",[a("strong",[s._v("ServletRequestMethodArgumentResolver  以上的部分参数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("@Override\n    public boolean supportsParameter(MethodParameter parameter) {\n        Class<?> paramType = parameter.getParameterType();\n        return (WebRequest.class.isAssignableFrom(paramType) ||\n                ServletRequest.class.isAssignableFrom(paramType) ||\n                MultipartRequest.class.isAssignableFrom(paramType) ||\n                HttpSession.class.isAssignableFrom(paramType) ||\n                (pushBuilder != null && pushBuilder.isAssignableFrom(paramType)) ||\n                Principal.class.isAssignableFrom(paramType) ||\n                InputStream.class.isAssignableFrom(paramType) ||\n                Reader.class.isAssignableFrom(paramType) ||\n                HttpMethod.class == paramType ||\n                Locale.class == paramType ||\n                TimeZone.class == paramType ||\n                ZoneId.class == paramType);\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h4",{attrs:{id:"_3-2-3-复杂参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-复杂参数"}},[s._v("#")]),s._v(" 3.2.3 复杂参数")]),s._v(" "),a("p",[a("strong",[s._v("Map")]),s._v("、"),a("strong",[s._v("Model（map、model里面的数据会被放在request的请求域  request.setAttribute）")]),s._v("、"),a("strong",[s._v("Errors/BindingResult、"),a("strong",[s._v("RedirectAttributes")]),s._v("（ 重定向携带数据）")]),s._v("、"),a("strong",[s._v("ServletResponse（response）")]),s._v("、SessionStatus、UriComponentsBuilder、ServletUriComponentsBuilder")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Map<String,Object> map,  Model model, HttpServletRequest request 都是可以给request域中放数据，\nrequest.getAttribute();\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("Map、Model 类型的参数")]),s._v("，会返回 mavContainer.getModel()；---\x3e BindingAwareModelMap 是 Model 也是 Map")]),s._v(" "),a("p",[a("strong",[s._v("mavContainer")]),s._v(".getModel(); 获取到值的")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182637.png",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182634.png",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182623.png",alt:"image.png"}})]),s._v(" "),a("h4",{attrs:{id:"_3-2-4-自定义对象参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-自定义对象参数"}},[s._v("#")]),s._v(" 3.2.4 自定义对象参数：")]),s._v(" "),a("p",[s._v("可以自动类型转换与格式化，可以级联封装。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('/**\n *     姓名： <input name="userName"/> <br/>\n *     年龄： <input name="age"/> <br/>\n *     生日： <input name="birth"/> <br/>\n *     宠物姓名：<input name="pet.name"/><br/>\n *     宠物年龄：<input name="pet.age"/>\n */\n@Data\npublic class Person {\n    \n    private String userName;\n    private Integer age;\n    private Date birth;\n    private Pet pet;\n    \n}\n\n@Data\npublic class Pet {\n\n    private String name;\n    private String age;\n\n}\n\nresult\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h3",{attrs:{id:"_3-3-pojo封装过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-pojo封装过程"}},[s._v("#")]),s._v(" 3.3 POJO封装过程")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ServletModelAttributeMethodProcessor")])])]),s._v(" "),a("h3",{attrs:{id:"_3-4-参数处理原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-参数处理原理"}},[s._v("#")]),s._v(" 3.4 参数处理原理")]),s._v(" "),a("ul",[a("li",[s._v("HandlerMapping 中找到能处理请求的Handler（Controller.method()）")]),s._v(" "),a("li",[s._v("为当前 Handler 找一个适配器 HandlerAdapter;"),a("strong",[s._v("RequestMappingHandlerAdapter")])]),s._v(" "),a("li",[s._v("适配器执行目标方法并确定方法参数的每一个值")])]),s._v(" "),a("h4",{attrs:{id:"_3-4-1-handleradapter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-handleradapter"}},[s._v("#")]),s._v(" 3.4.1 HandlerAdapter")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182642.png",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("支持方法上标注@RequestMapping")])]),s._v(" "),a("li",[a("p",[s._v("支持函数式编程的")])]),s._v(" "),a("li",[a("p",[s._v("......")])])]),s._v(" "),a("h4",{attrs:{id:"_3-4-2-执行目标方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-执行目标方法"}},[s._v("#")]),s._v(" 3.4.2 执行目标方法")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// Actually invoke the handler.\n//DispatcherServlet -- doDispatch\nmv = ha.handle(processedRequest, response, mappedHandler.getHandler());\nmav = invokeHandlerMethod(request, response, handlerMethod); //执行目标方法\n\n\n//ServletInvocableHandlerMethod\nObject returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);\n//获取方法的参数值\nObject[] args = getMethodArgumentValues(request, mavContainer, providedArgs);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_3-4-3-参数解析器-handlermethodargumentresolver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-3-参数解析器-handlermethodargumentresolver"}},[s._v("#")]),s._v(" 3.4.3 参数解析器 HandlerMethodArgumentResolver")]),s._v(" "),a("p",[s._v("确定将要执行的目标方法的每一个参数的值是什么")]),s._v(" "),a("p",[s._v("SpringMVC目标方法能写多少种参数类型。取决于参数解析器。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182738.png",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306183408.png",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("当前解析器是否支持解析这种参数")]),s._v(" "),a("li",[s._v("支持就调用 resolveArgument")])]),s._v(" "),a("h4",{attrs:{id:"_3-4-4-返回值处理器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-4-返回值处理器"}},[s._v("#")]),s._v(" 3.4.4 返回值处理器")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182747.png",alt:"image.png"}})]),s._v(" "),a("h4",{attrs:{id:"_3-4-5-如何确定目标方法每一个参数的值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-5-如何确定目标方法每一个参数的值"}},[s._v("#")]),s._v(" 3.4.5 如何确定目标方法每一个参数的值")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('============InvocableHandlerMethod==========================\nprotected Object[] getMethodArgumentValues(NativeWebRequest request, @Nullable ModelAndViewContainer mavContainer,\n            Object... providedArgs) throws Exception {\n\n        MethodParameter[] parameters = getMethodParameters();\n        if (ObjectUtils.isEmpty(parameters)) {\n            return EMPTY_ARGS;\n        }\n\n        Object[] args = new Object[parameters.length];\n        for (int i = 0; i < parameters.length; i++) {\n            MethodParameter parameter = parameters[i];\n            parameter.initParameterNameDiscovery(this.parameterNameDiscoverer);\n            args[i] = findProvidedArgument(parameter, providedArgs);\n            if (args[i] != null) {\n                continue;\n            }\n            if (!this.resolvers.supportsParameter(parameter)) {\n                throw new IllegalStateException(formatArgumentError(parameter, "No suitable resolver"));\n            }\n            try {\n                args[i] = this.resolvers.resolveArgument(parameter, mavContainer, request, this.dataBinderFactory);\n            }\n            catch (Exception ex) {\n                // Leave stack trace for later, exception may actually be resolved and handled...\n                if (logger.isDebugEnabled()) {\n                    String exMsg = ex.getMessage();\n                    if (exMsg != null && !exMsg.contains(parameter.getExecutable().toGenericString())) {\n                        logger.debug(formatArgumentError(parameter, exMsg));\n                    }\n                }\n                throw ex;\n            }\n        }\n        return args;\n    }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("ul",[a("li",[s._v("挨个判断所有参数解析器那个支持解析这个参数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    @Nullable\n    private HandlerMethodArgumentResolver getArgumentResolver(MethodParameter parameter) {\n        HandlerMethodArgumentResolver result = this.argumentResolverCache.get(parameter);\n        if (result == null) {\n            for (HandlerMethodArgumentResolver resolver : this.argumentResolvers) {\n                if (resolver.supportsParameter(parameter)) {\n                    result = resolver;\n                    this.argumentResolverCache.put(parameter, result);\n                    break;\n                }\n            }\n        }\n        return result;\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ul",[a("li",[s._v("解析这个参数的值")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("调用各自 HandlerMethodArgumentResolver 的 resolveArgument 方法即可\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("自定义类型参数 封装POJO")])]),s._v(" "),a("p",[a("strong",[s._v("ServletModelAttributeMethodProcessor  这个参数处理器支持")])]),s._v(" "),a("p",[a("strong",[s._v("是否为简单类型。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('public static boolean isSimpleValueType(Class<?> type) {\n        return (Void.class != type && void.class != type &&\n                (ClassUtils.isPrimitiveOrWrapper(type) ||\n                Enum.class.isAssignableFrom(type) ||\n                CharSequence.class.isAssignableFrom(type) ||\n                Number.class.isAssignableFrom(type) ||\n                Date.class.isAssignableFrom(type) ||\n                Temporal.class.isAssignableFrom(type) ||\n                URI.class == type ||\n                URL.class == type ||\n                Locale.class == type ||\n                Class.class == type));\n    }\n@Override\n    @Nullable\n    public final Object resolveArgument(MethodParameter parameter, @Nullable ModelAndViewContainer mavContainer,\n            NativeWebRequest webRequest, @Nullable WebDataBinderFactory binderFactory) throws Exception {\n\n        Assert.state(mavContainer != null, "ModelAttributeMethodProcessor requires ModelAndViewContainer");\n        Assert.state(binderFactory != null, "ModelAttributeMethodProcessor requires WebDataBinderFactory");\n\n        String name = ModelFactory.getNameForParameter(parameter);\n        ModelAttribute ann = parameter.getParameterAnnotation(ModelAttribute.class);\n        if (ann != null) {\n            mavContainer.setBinding(name, ann.binding());\n        }\n\n        Object attribute = null;\n        BindingResult bindingResult = null;\n\n        if (mavContainer.containsAttribute(name)) {\n            attribute = mavContainer.getModel().get(name);\n        }\n        else {\n            // Create attribute instance\n            try {\n                attribute = createAttribute(name, parameter, binderFactory, webRequest);\n            }\n            catch (BindException ex) {\n                if (isBindExceptionRequired(parameter)) {\n                    // No BindingResult parameter -> fail with BindException\n                    throw ex;\n                }\n                // Otherwise, expose null/empty value and associated BindingResult\n                if (parameter.getParameterType() == Optional.class) {\n                    attribute = Optional.empty();\n                }\n                bindingResult = ex.getBindingResult();\n            }\n        }\n\n        if (bindingResult == null) {\n            // Bean property binding and validation;\n            // skipped in case of binding failure on construction.\n            WebDataBinder binder = binderFactory.createBinder(webRequest, attribute, name);\n            if (binder.getTarget() != null) {\n                if (!mavContainer.isBindingDisabled(name)) {\n                    bindRequestParameters(binder, webRequest);\n                }\n                validateIfApplicable(binder, parameter);\n                if (binder.getBindingResult().hasErrors() && isBindExceptionRequired(binder, parameter)) {\n                    throw new BindException(binder.getBindingResult());\n                }\n            }\n            // Value type adaptation, also covering java.util.Optional\n            if (!parameter.getParameterType().isInstance(attribute)) {\n                attribute = binder.convertIfNecessary(binder.getTarget(), parameter.getParameterType(), parameter);\n            }\n            bindingResult = binder.getBindingResult();\n        }\n\n        // Add resolved attribute and BindingResult at the end of the model\n        Map<String, Object> bindingResultModel = bindingResult.getModel();\n        mavContainer.removeAttributes(bindingResultModel);\n        mavContainer.addAllAttributes(bindingResultModel);\n\n        return attribute;\n    }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br")])]),a("p",[a("strong",[s._v("WebDataBinder binder = binderFactory.createBinder(webRequest, attribute, name);")])]),s._v(" "),a("p",[a("strong",[s._v("WebDataBinder :web数据绑定器，将请求参数的值绑定到指定的JavaBean里面")])]),s._v(" "),a("p",[a("strong",[s._v("WebDataBinder 利用它里面的 Converters 将请求数据转成指定的数据类型。再次封装到JavaBean中")])]),s._v(" "),a("p",[a("strong",[s._v("GenericConversionService：在设置每一个值的时候，找它里面的所有converter那个可以将这个数据类型（request带来参数的字符串）转换到指定的类型（JavaBean -- Integer）")])]),s._v(" "),a("p",[a("strong",[s._v("byte -- > file")])]),s._v(" "),a("p",[s._v("@FunctionalInterface "),a("strong",[s._v("public interface")]),s._v(" Converter<S, T>")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182754.png",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182759.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("未来我们可以给WebDataBinder里面放自己的Converter；")]),s._v(" "),a("p",[a("strong",[s._v("private static final class")]),s._v(" StringToNumber<T "),a("strong",[s._v("extends")]),s._v(" Number> "),a("strong",[s._v("implements")]),s._v(" Converter<String, T>")]),s._v(" "),a("p",[s._v("自定义 Converter")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('//1、WebMvcConfigurer定制化SpringMVC的功能\n@Bean\npublic WebMvcConfigurer webMvcConfigurer(){\n    return new WebMvcConfigurer() {\n        @Override\n        public void configurePathMatch(PathMatchConfigurer configurer) {\n            UrlPathHelper urlPathHelper = new UrlPathHelper();\n            // 不移除；后面的内容。矩阵变量功能就可以生效\n            urlPathHelper.setRemoveSemicolonContent(false);\n            configurer.setUrlPathHelper(urlPathHelper);\n        }\n\n        @Override\n        public void addFormatters(FormatterRegistry registry) {\n            registry.addConverter(new Converter<String, Pet>() {\n\n                @Override\n                public Pet convert(String source) {\n                    // 啊猫,3\n                    if(!StringUtils.isEmpty(source)){\n                        Pet pet = new Pet();\n                        String[] split = source.split(",");\n                        pet.setName(split[0]);\n                        pet.setAge(Integer.parseInt(split[1]));\n                        return pet;\n                    }\n                    return null;\n                }\n            });\n        }\n    };\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("h4",{attrs:{id:"_3-4-6-目标方法执行完成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-6-目标方法执行完成"}},[s._v("#")]),s._v(" 3.4.6 目标方法执行完成")]),s._v(" "),a("p",[s._v("将所有的数据都放在 "),a("strong",[s._v("ModelAndViewContainer")]),s._v("；包含要去的页面地址 View。还包含   Model 数据。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182805.png",alt:"image.png"}})]),s._v(" "),a("h4",{attrs:{id:"_3-4-7-处理派发结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-7-处理派发结果"}},[s._v("#")]),s._v(" 3.4.7 处理派发结果")]),s._v(" "),a("p",[a("strong",[s._v("processDispatchResult")]),s._v("(processedRequest, response, mappedHandler, mv, dispatchException);")]),s._v(" "),a("p",[s._v("renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('InternalResourceView：\n@Override\nprotected void renderMergedOutputModel(\n        Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) throws Exception {\n\n    // Expose the model object as request attributes.\n    exposeModelAsRequestAttributes(model, request);\n\n    // Expose helpers as request attributes, if any.\n    exposeHelpers(request);\n\n    // Determine the path for the request dispatcher.\n    String dispatcherPath = prepareForRendering(request, response);\n\n    // Obtain a RequestDispatcher for the target resource (typically a JSP).\n    RequestDispatcher rd = getRequestDispatcher(request, dispatcherPath);\n    if (rd == null) {\n        throw new ServletException("Could not get RequestDispatcher for [" + getUrl() +\n                "]: Check that the corresponding file exists within your web application archive!");\n    }\n\n    // If already included or response already committed, perform include, else forward.\n    if (useInclude(request, response)) {\n        response.setContentType(getContentType());\n        if (logger.isDebugEnabled()) {\n            logger.debug("Including [" + getUrl() + "]");\n        }\n        rd.include(request, response);\n    }\n\n    else {\n        // Note: The forwarded resource is supposed to determine the content type itself.\n        if (logger.isDebugEnabled()) {\n            logger.debug("Forwarding to [" + getUrl() + "]");\n        }\n        rd.forward(request, response);\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("暴露模型作为请求域属性\n// Expose the model object as request attributes.\n        exposeModelAsRequestAttributes(model, request);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("protected void exposeModelAsRequestAttributes(Map<String, Object> model,\n            HttpServletRequest request) throws Exception {\n\n    //model中的所有数据遍历挨个放在请求域中\n        model.forEach((name, value) -> {\n            if (value != null) {\n                request.setAttribute(name, value);\n            }\n            else {\n                request.removeAttribute(name);\n            }\n        });\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"_4-数据响应与内容协商"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-数据响应与内容协商"}},[s._v("#")]),s._v(" 4. 数据响应与内容协商")]),s._v(" "),a("p",[s._v("自定义协议数据JSON图片、音视频....XMLxls响应数据响应页面数据响应")]),s._v(" "),a("h3",{attrs:{id:"_4-1-响应json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-响应json"}},[s._v("#")]),s._v(" 4.1 响应JSON")]),s._v(" "),a("h4",{attrs:{id:"_4-1-1-jackson-jar-responsebody"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-jackson-jar-responsebody"}},[s._v("#")]),s._v(" 4.1.1 jackson.jar + @ResponseBody")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-web</artifactId>\n</dependency>\nweb场景自动引入了json场景\n<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-json</artifactId>\n  <version>2.3.4.RELEASE</version>\n  <scope>compile</scope>\n</dependency>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182813.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("给前端自动返回json数据；")]),s._v(" "),a("ol",[a("li",[s._v("返回值解析器")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306181113.png",alt:"image.png"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('try {\n            this.returnValueHandlers.handleReturnValue(\n                    returnValue, getReturnValueType(returnValue), mavContainer, webRequest);\n        }\n    @Override\n    public void handleReturnValue(@Nullable Object returnValue, MethodParameter returnType,\n            ModelAndViewContainer mavContainer, NativeWebRequest webRequest) throws Exception {\n\n        HandlerMethodReturnValueHandler handler = selectHandler(returnValue, returnType);\n        if (handler == null) {\n            throw new IllegalArgumentException("Unknown return value type: " + returnType.getParameterType().getName());\n        }\n        handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);\n    }\nRequestResponseBodyMethodProcessor      \n@Override\n    public void handleReturnValue(@Nullable Object returnValue, MethodParameter returnType,\n            ModelAndViewContainer mavContainer, NativeWebRequest webRequest)\n            throws IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException {\n\n        mavContainer.setRequestHandled(true);\n        ServletServerHttpRequest inputMessage = createInputMessage(webRequest);\n        ServletServerHttpResponse outputMessage = createOutputMessage(webRequest);\n\n        // Try even with null return value. ResponseBodyAdvice could get involved.\n        // 使用消息转换器进行写出操作\n        writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);\n    }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("返回值解析器原理")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182825.png",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("返回值处理器判断是否支持这种类型返回值 supportsReturnType")]),s._v(" "),a("li",[s._v("返回值处理器调用 handleReturnValue 进行处理")]),s._v(" "),a("li",[s._v("RequestResponseBodyMethodProcessor 可以处理返回值标了@ResponseBody 注解的。\n"),a("ul",[a("li",[s._v("利用 MessageConverters 进行处理 将数据写为json")]),s._v(" "),a("li",[s._v("内容协商（浏览器默认会以请求头的方式告诉服务器他能接受什么样的内容类型）")]),s._v(" "),a("li",[s._v("服务器最终根据自己自身的能力，决定服务器能生产出什么样内容类型的数据，")]),s._v(" "),a("li",[s._v("SpringMVC 会挨个遍历所有容器底层的 HttpMessageConverter ，看谁能处理？\n"),a("ul",[a("li",[s._v("得到 MappingJackson2HttpMessageConverter 可以将对象写为 json")]),s._v(" "),a("li",[s._v("利用 MappingJackson2HttpMessageConverter 将对象转为 json 再写出去。")])])])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182829.png",alt:"image.png"}})]),s._v(" "),a("h4",{attrs:{id:"_4-1-2-springmvc-到底支持哪些返回值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-2-springmvc-到底支持哪些返回值"}},[s._v("#")]),s._v(" 4.1.2 SpringMVC 到底支持哪些返回值")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ModelAndView\nModel\nView\nResponseEntity \nResponseBodyEmitter\nStreamingResponseBody\nHttpEntity\nHttpHeaders\nCallable\nDeferredResult\nListenableFuture\nCompletionStage\nWebAsyncTask\n有 @ModelAttribute 且为对象类型的\n@ResponseBody 注解 ---\x3e RequestResponseBodyMethodProcessor；\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h4",{attrs:{id:"_4-1-3-httpmessageconverter原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-3-httpmessageconverter原理"}},[s._v("#")]),s._v(" 4.1.3 HTTPMessageConverter原理")]),s._v(" "),a("ol",[a("li",[s._v("MessageConverter规范")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182831.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("HttpMessageConverter: 看是否支持将 此 Class类型的对象，转为MediaType类型的数据。")]),s._v(" "),a("p",[s._v("例子：Person对象转为JSON。或者 JSON转为Person")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("默认的MessageConverter")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182836.png",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("0 - 只支持Byte类型的")]),s._v(" "),a("li",[s._v("1 - String")]),s._v(" "),a("li",[s._v("2 - String")]),s._v(" "),a("li",[s._v("3 - Resource")]),s._v(" "),a("li",[s._v("4 - ResourceRegion")]),s._v(" "),a("li",[s._v("5 - DOMSource.class\\ SAXSource.class\\ StAXSource.class \\StreamSource.class \\Source.class")]),s._v(" "),a("li",[s._v("6 - MultiValueMap")]),s._v(" "),a("li",[s._v("7 - true")]),s._v(" "),a("li",[s._v("8 - true")]),s._v(" "),a("li",[s._v("9 - 支持注解方式xml处理的。")])]),s._v(" "),a("p",[s._v("最终 MappingJackson2HttpMessageConverter  把对象转为JSON（利用底层的jackson的objectMapper转换的）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182841.png",alt:"image.png"}})]),s._v(" "),a("h3",{attrs:{id:"_4-2-内容协商"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-内容协商"}},[s._v("#")]),s._v(" 4.2 内容协商")]),s._v(" "),a("p",[s._v("根据客户端接收能力不同，返回不同媒体类型的数据。")]),s._v(" "),a("h4",{attrs:{id:"_4-2-1-引入xml依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-引入xml依赖"}},[s._v("#")]),s._v(" 4.2.1 引入xml依赖")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<dependency>\n\t<groupId>com.fasterxml.jackson.dataformat</groupId>\n\t<artifactId>jackson-dataformat-xml</artifactId>\n</dependency>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_4-2-2-postman分别测试返回json和xml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-postman分别测试返回json和xml"}},[s._v("#")]),s._v(" 4.2.2 postman分别测试返回json和xml")]),s._v(" "),a("p",[s._v("只需要改变请求头中 Accept 字段。Http 协议中规定的，告诉服务器本客户端可以接收的数据类型。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182843.png",alt:"image.png"}})]),s._v(" "),a("h4",{attrs:{id:"_4-2-3-开启浏览器参数方式内容协商功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-3-开启浏览器参数方式内容协商功能"}},[s._v("#")]),s._v(" 4.2.3 开启浏览器参数方式内容协商功能")]),s._v(" "),a("p",[s._v("为了方便内容协商，开启基于请求参数的内容协商功能。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("spring:\n    contentnegotiation:\n      favor-parameter: true  #开启请求参数内容协商模式\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("发请求： http://localhost:8080/test/person?format=json")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://localhost:8080/test/person?format=json",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:8080/test/person?format="),a("OutboundLink")],1),s._v("xml")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182901.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("确定客户端接收什么样的内容类型；")]),s._v(" "),a("ol",[a("li",[s._v("Parameter策略优先确定是要返回json数据（获取请求头中的format的值）")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182914.png",alt:"image.png"}})]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("最终进行内容协商返回给客户端json即可。")])]),s._v(" "),a("h4",{attrs:{id:"_4-2-4-内容协商原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-4-内容协商原理"}},[s._v("#")]),s._v(" 4.2.4 内容协商原理")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("判断当前响应头中是否已经有确定的媒体类型。MediaType")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("获取客户端（PostMan、浏览器）支持接收的内容类型。（获取客户端Accept请求头字段）【application/xml】")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("contentNegotiationManager 内容协商管理器 默认使用基于请求头的策略")])])]),s._v(" "),a("li",[a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182926.png",alt:"image.png"}})])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("HeaderContentNegotiationStrategy  确定客户端可以接收的内容类型")])])]),s._v(" "),a("li",[a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182923.png",alt:"image.png"}})])]),s._v(" "),a("li",[a("p",[s._v("3、遍历循环所有当前系统的 "),a("strong",[s._v("MessageConverter")]),s._v("，看谁支持操作这个对象（Person）")])]),s._v(" "),a("li",[a("p",[s._v("4、找到支持操作Person的converter，把converter支持的媒体类型统计出来。")])]),s._v(" "),a("li",[a("p",[s._v("5、客户端需要【application/xml】。服务端能力【10种、json、xml】")])]),s._v(" "),a("li",[a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182946.png",alt:"image.png"}})])]),s._v(" "),a("li",[a("p",[s._v("6、进行内容协商的最佳匹配媒体类型")])]),s._v(" "),a("li",[a("p",[s._v("7、用 支持 将对象转为 最佳匹配媒体类型 的converter。调用它进行转化 。")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182953.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("导入了jackson处理xml的包，xml的converter就会自动进来")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('WebMvcConfigurationSupport\njackson2XmlPresent = ClassUtils.isPresent("com.fasterxml.jackson.dataformat.xml.XmlMapper", classLoader);\n\nif (jackson2XmlPresent) {\n    Jackson2ObjectMapperBuilder builder = Jackson2ObjectMapperBuilder.xml();\n    if (this.applicationContext != null) {\n        builder.applicationContext(this.applicationContext);\n    }\n    messageConverters.add(new MappingJackson2XmlHttpMessageConverter(builder.build()));\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_4-4-5-自定义-messageconverter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-5-自定义-messageconverter"}},[s._v("#")]),s._v(" 4.4.5 自定义 MessageConverter")]),s._v(" "),a("p",[a("strong",[s._v("实现多协议数据兼容。json、xml、x-guigu")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("@ResponseBody")]),s._v(" 响应数据出去 调用 "),a("strong",[s._v("RequestResponseBodyMethodProcessor")]),s._v(" 处理")]),s._v(" "),a("li",[s._v("Processor 处理方法返回值。通过 "),a("strong",[s._v("MessageConverter")]),s._v(" 处理")]),s._v(" "),a("li",[s._v("所有 "),a("strong",[s._v("MessageConverter")]),s._v(" 合起来可以支持各种媒体类型数据的操作（读、写）")]),s._v(" "),a("li",[s._v("内容协商找到最终的 "),a("strong",[s._v("messageConverter")]),s._v("；")])]),s._v(" "),a("p",[s._v("SpringMVC的什么功能。一个入口给容器中添加一个  WebMvcConfigurer")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" @Bean\npublic WebMvcConfigurer webMvcConfigurer(){\n    return new WebMvcConfigurer() {\n\n        @Override\n        public void extendMessageConverters(List<HttpMessageConverter<?>> converters) {\n\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306182959.png",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kidy4088/Pic/20210306183003.png",alt:"image.png"}})]),s._v(" "),a("p",[a("strong",[s._v("有可能我们添加的自定义的功能会覆盖默认很多功能，导致一些默认的功能失效。")])])])}),[],!1,null,null,null);e.default=t.exports}}]);